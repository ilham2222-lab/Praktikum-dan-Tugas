<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Lowongan Kerja</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="container mt-4">
        <h3>Lowongan Kerja</h3>

        <input type="hidden" id="id">

        <div class="form-group">
            <input type="text" id="posisi" class="form-control" placeholder="Posisi">
        </div>
        <div class="form-group">
            <input type="text" id="perusahaan" class="form-control" placeholder="Perusahaan">
        </div>
        <div class="form-group">
            <input type="text" id="lokasi" class="form-control" placeholder="Lokasi">
        </div>
        <div class="form-group">
            <input type="text" id="gaji" class="form-control" placeholder="Gaji">
        </div>
        <div class="form-group">
            <input type="text" id="deskripsi" class="form-control" placeholder="Deskripsi">
        </div>

        <button class="btn btn-primary" onclick="insert()">Simpan</button>
        <button class="btn btn-warning" onclick="update()">Update</button>

        <hr>

        <input type="text" id="keyword" placeholder="Cari lowongan">
        <button class="btn btn-info" onclick="search()">Cari</button>

        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Posisi</th>
                    <th>Perusahaan</th>
                    <th>Lokasi</th>
                    <th>Gaji</th>
                    <th>Deskripsi</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="data"></tbody>
        </table>
    </div>

    <script>
        const API = 'https://script.google.com/macros/s/AKfycbz3oUXKWgzh3rNjz6eFMx_qB-BBAzSjGwPQopGJjFqIz7QEOhopMFdFNiBVUTvHlI1R/exec';

        function load() {
            $.get(API, { action: "read" }, show);
        }

        function insert() {
            $.get(API, {
                action: "insert",
                posisi: posisi.value,
                perusahaan: perusahaan.value,
                lokasi: lokasi.value,
                gaji: gaji.value,
                deskripsi: deskripsi.value
            }, () => load());
        }

        function update() {
            $.get(API, {
                action: "update",
                id: id.value,
                posisi: posisi.value,
                perusahaan: perusahaan.value,
                lokasi: lokasi.value,
                gaji: gaji.value,
                deskripsi: deskripsi.value
            }, () => load());
        }

        function del(id) {
            $.get(API, { action: "delete", id }, () => load());
        }

        function search() {
            $.get(API, { action: "search", keyword: keyword.value }, show);
        }

        function fill(d) {
            id.value = d.ID;
            posisi.value = d.Posisi;
            perusahaan.value = d.Perusahaan;
            lokasi.value = d.Lokasi;
            gaji.value = d.Gaji;
            deskripsi.value = d.Deskripsi;
        }

        function show(data) {
            $("#data").empty();
            data.forEach(d => {
                $("#data").append(`
<tr>
<td>${d.ID}</td>
<td>${d.Posisi}</td>
<td>${d.Perusahaan}</td>
<td>${d.Lokasi}</td>
<td>${d.Gaji}</td>
<td>${d.Deskripsi}</td>
<td>
<button class="btn btn-sm btn-warning" onclick='fill(${JSON.stringify(d)})'>Edit</button>
<button class="btn btn-sm btn-danger" onclick='del(${d.ID})'>Hapus</button>
</td>
</tr>
`);
            });
        }

        load();
    </script>
</body>

</html>